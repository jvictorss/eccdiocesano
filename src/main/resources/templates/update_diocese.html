<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Editar Diocese</title>
    <link rel="stylesheet" type="text/css" href="/verbum-ecc/css/create_diocese.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/verbum-ecc/js/functions.js"></script>
</head>
<body>
<div id="navbar" th:replace="~{fragments/navbar :: navbar}"></div>
<div>
    <h1>Editar Diocese</h1>
    <form>
        <input type="hidden" id="idDiocese" th:value="${diocese.id}" />
        <div class="grid-section">
            <div>
                <label for="nome">Nome da Diocese:</label>
                <input type="text" id="nome" th:value="${diocese.nome}" />
            </div>
            <div>
                <label for="cidade">Cidade:</label>
                <input type="text" id="cidade" th:value="${diocese.cidade}" />
            </div>
            <div>
                <label for="estado">Estado:</label>
                <input type="text" id="estado" th:value="${diocese.estado}" />
            </div>
        </div>
        <div>
            <button type="button" class="salvar" onclick="saveDiocese()">Salvar</button>
            <button type="button" class="btn-cancel" onclick="cancel()">Voltar</button>
        </div>
    </form>
</div>
<footer th:replace="~{fragments/footer :: footer}"></footer>
<script>
    async function fetchDioceseData(dioceseId) {
        try {
            const response = await fetch(`http://localhost:8080/verbum-ecc/v1/diocese/${dioceseId}`);
            if (response.ok) {
                const diocese = await response.json();
                document.getElementById('nome').value = diocese.nome;
                document.getElementById('cidade').value = diocese.cidade;
                document.getElementById('estado').value = diocese.estado;
            } else {
                console.error('Failed to fetch diocese data');
            }
        } catch (error) {
            console.error('Error fetching diocese data:', error);
        }
    }

    async function saveDiocese() {
        const dioceseId = document.getElementById('idDiocese').value;
        const parameters = {
            nome: document.getElementById('nome').value,
            cidade: document.getElementById('cidade').value,
            estado: document.getElementById('estado').value
        };

        try {
            const response = await fetch(`http://localhost:8080/verbum-ecc/v1/diocese/${dioceseId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(parameters)
            });

            if (response.ok) {
                alert('Diocese atualizada com sucesso!');
                window.location.href = '/verbum-ecc/v1/diocese/view';
            } else {
                alert('Falha ao atualizar diocese.');
            }
        } catch (error) {
            console.error('Error updating diocese:', error);
        }
    }

    window.onload = function() {
        const dioceseId = document.getElementById('idDiocese').value;
        fetchDioceseData(dioceseId);
    };
</script>
</body>
</html>