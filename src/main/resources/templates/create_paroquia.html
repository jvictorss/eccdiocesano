<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Criar Paróquia</title>
    <link rel="stylesheet" type="text/css" href="/verbum-ecc/css/create_usuario.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://getbootstrap.com/docs/5.3/assets/css/docs.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <title>VerbumECC - Home</title>
<!--    <link rel="stylesheet" type="text/css" href="/verbum-ecc/css/create_diocese.css">-->
    <script>
        function createDiocese() {
            window.location.href = '/verbum-ecc/v1/diocese/form';
        }

        function viewDioceses() {
            window.location.href = '/verbum-ecc/v1/diocese/view';
        }

        function createSetor() {
            window.location.href = '/verbum-ecc/v1/setor/form';
        }

        function viewSetores() {
            window.location.href = '/verbum-ecc/v1/setor/view';
        }

        function createParoquia() {
            window.location.href = '/verbum-ecc/v1/paroquia/form';
        }

        function viewParoquias() {
            window.location.href = '/verbum-ecc/v1/paroquia/view';
        }

        function createCasal() {
            window.location.href = '/verbum-ecc/v1/casal/form';
        }

        function viewCasal() {
            window.location.href = '/verbum-ecc/v1/casal/view';
        }

        function createUsuario() {
            window.location.href = '/verbum-ecc/v1/usuario/form'
        }

        function verUsuarios() {
            window.location.href = '/verbum-ecc/v1/usuario/view'
        }
    </script>
    <script>
        const estados = [
            "Acre", "Alagoas", "Amapá", "Amazonas", "Bahia", "Ceará", "Distrito Federal", "Espírito Santo",
            "Goiás", "Maranhão", "Mato Grosso", "Mato Grosso do Sul", "Minas Gerais", "Pará", "Paraíba",
            "Paraná", "Pernambuco", "Piauí", "Rio de Janeiro", "Rio Grande do Norte", "Rio Grande do Sul",
            "Rondônia", "Roraima", "Santa Catarina", "São Paulo", "Sergipe", "Tocantins"
        ];

        async function fetchDioceses() {
            try {
                const response = await fetch('http://localhost:8080/verbum-ecc/v1/diocese/all/isActive=true', {
                    method: 'GET'
                });

                if (response.ok) {
                    const dioceses = await response.json();
                    const select = document.getElementById('diocese');
                    dioceses.forEach(diocese => {
                        const option = document.createElement('option');
                        option.value = diocese.id;
                        option.textContent = diocese.nome;
                        select.appendChild(option);
                    });
                } else {
                    console.error('Failed to fetch dioceses');
                }
            } catch (error) {
                console.error('Error fetching dioceses:', error);
            }
        }

        async function fetchSetores() {
            try {
                const response = await fetch('http://localhost:8080/verbum-ecc/v1/setorial/all/isActive=true', {
                    method: 'GET'
                });

                if (response.ok) {
                    const setores = await response.json();
                    const select = document.getElementById('setor');
                    setores.forEach(setor => {
                        const option = document.createElement('option');
                        option.value = setor.id;
                        option.textContent = setor.nome;
                        select.appendChild(option);
                    });
                } else {
                    console.error('Failed to fetch setores');
                }
            } catch (error) {
                console.error('Error fetching setores:', error);
            }
        }

        function populateEstados() {
            const selectEstado = document.getElementById('estado');
            estados.forEach(estado => {
                const option = document.createElement('option');
                option.value = estado;
                option.textContent = estado;
                selectEstado.appendChild(option);
            });
        }

        async function createParoquia(event) {
            event.preventDefault();

            const nome = document.getElementById('nome').value;
            const cidade = document.getElementById('cidade').value;
            const estado = document.getElementById('estado').value;
            const idDiocese = document.getElementById('diocese').value;
            const idSetor = document.getElementById('setor').value;
            // const tenantId = document.getElementById('tenantId').value;
            const isActive = document.getElementById('isActive').checked;

            try {
                const response = await fetch('http://localhost:8080/verbum-ecc/v1/paroquia/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        nome: nome,
                        cidade: cidade,
                        estado: estado,
                        idDiocese: idDiocese,
                        idSetor: idSetor,
                        isActive: isActive
                    })
                });

                if (response.ok) {
                    alert('Paróquia criada com sucesso!');
                    clear();
                } else {
                    alert('Falha ao criar paróquia. Entre em contato com o Administrador.');
                }
            } catch (error) {
                console.error('Error creating paróquia:', error);
            }
        }

        function cancel() {
            window.location.href = '/verbum-ecc/v1/home';
        }

        function clear() {
            document.getElementById('nome').value = '';
            document.getElementById('cidade').value = '';
            document.getElementById('estado').value = '';
            document.getElementById('diocese').value = '';
            document.getElementById('setor').value = '';
            document.getElementById('tenantId').value = '';
            document.getElementById('isActive').checked = false;
        }

        document.addEventListener('DOMContentLoaded', fetchDioceses);
        document.addEventListener('DOMContentLoaded', fetchSetores);
        document.addEventListener('DOMContentLoaded', populateEstados);
    </script>
</head>
<body>
<div id="navbar" th:replace="~{fragments/navbar :: navbar}"></div>
<div id="js-placeholder"></div>

<h1>Criar Nova Paróquia</h1>
<form onsubmit="createParoquia(event); cancel();" >
    <div>
        <label for="nome">Nome Paróquia:</label>
        <input type="text" id="nome" required />
    </div>
    <div>
        <label for="cidade">Cidade:</label>
        <input type="text" id="cidade" required />
    </div>
    <div>
        <label for="estado">Estado:</label>
        <select id="estado" required>
            <option value="">Selecione um estado</option>
        </select>
    </div>
    <div>
        <label for="diocese">Diocese:</label>
        <select id="diocese" required>
            <option value="">Selecione uma diocese</option>
        </select>
    </div>
    <div>
        <label for="setor">Setorial:</label>
        <select id="setor" required>
            <option value="">Selecione um setorial</option>
        </select>
    </div>
    <div>
        <label for="isActive">Ativo:</label>
        <input type="checkbox" id="isActive" />
    </div>
    <div>
        <button type="submit">Create</button>
        <button type="reset" class="btn-clear" onclick="clear()"> Limpar </button>
        <button type="button" class="btn-cancel" onclick="cancel()"> Cancelar </button>
    </div>
</form>
<!--<div id="footer"></div>-->
<!--<script>-->
<!--    function loadFooter() {-->
<!--        fetch('/verbum-ecc/v1/footer')-->
<!--            .then(response => response.text())-->
<!--            .then(data => {-->
<!--                document.getElementById('footer').innerHTML = data;-->
<!--            });-->
<!--    }-->

<!--    window.onload = function() {-->
<!--        loadFooter();-->
<!--    };-->
<!--</script>-->
<!--<div id="navbar" th:replace="~{fragments/navbar :: navbar}"></div>-->
<!--<div id="js-placeholder"></div>-->
<footer th:replace="~{fragments/footer :: footer}"></footer>
</body>
</html>
